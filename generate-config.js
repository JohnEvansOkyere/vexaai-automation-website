#!/usr/bin/env node
/**
 * Generate env-config.js from .env file
 * This script reads your .env file and generates a JavaScript config file
 * that can be safely included in your HTML without exposing secrets.
 *
 * Usage: node generate-config.js
 */

const fs = require('fs');
const path = require('path');

// Read .env file
const envPath = path.join(__dirname, '.env');
const envExamplePath = path.join(__dirname, '.env.example');

if (!fs.existsSync(envPath)) {
    console.log('âš ï¸  No .env file found. Creating from .env.example...');
    if (fs.existsSync(envExamplePath)) {
        fs.copyFileSync(envExamplePath, envPath);
        console.log('âœ… Created .env file. Please edit it with your actual values.');
        console.log('ðŸ“ Edit .env and run this script again.');
        process.exit(0);
    } else {
        console.error('âŒ No .env.example file found!');
        process.exit(1);
    }
}

// Parse .env file
const envContent = fs.readFileSync(envPath, 'utf-8');
const env = {};

envContent.split('\n').forEach(line => {
    line = line.trim();
    if (line && !line.startsWith('#')) {
        const [key, ...valueParts] = line.split('=');
        const value = valueParts.join('=').trim();
        env[key] = value;
    }
});

// Generate env-config.js
const configContent = `/**
 * VexaAI Environment Configuration
 * This file is auto-generated from .env file.
 *
 * DO NOT EDIT THIS FILE MANUALLY!
 * To update: Edit .env file and run: node generate-config.js
 *
 * Generated: ${new Date().toISOString()}
 */

window.ENV = {
    PAYSTACK_PUBLIC_KEY: '${env.VITE_PAYSTACK_PUBLIC_KEY || 'pk_test_xxxxxxxxxxxxxxxxxxxxxxxxxx'}',
    API_URL: '${env.VITE_API_URL || 'http://localhost:8000'}',
    NOTION_LIBRARY_URL: '${env.VITE_NOTION_LIBRARY_URL || 'https://notion.so/your-private-library'}',
    WHATSAPP_NUMBER: '${env.VITE_WHATSAPP_NUMBER || '233544954643'}',
    ADMIN_EMAIL: '${env.VITE_ADMIN_EMAIL || 'johnevansokyere@gmail.com'}',
    SINGLE_WORKFLOW_PRICE: ${env.VITE_SINGLE_WORKFLOW_PRICE || 149},
    ALL_ACCESS_PRICE: ${env.VITE_ALL_ACCESS_PRICE || 799},
};

// Log config loaded (without sensitive data)
console.log('âœ… VexaAI Config loaded:', {
    paystackKey: window.ENV.PAYSTACK_PUBLIC_KEY.substring(0, 15) + '...',
    apiUrl: window.ENV.API_URL,
});
`;

// Write env-config.js
const configPath = path.join(__dirname, 'env-config.js');
fs.writeFileSync(configPath, configContent);

console.log('âœ… Generated env-config.js successfully!');
console.log('ðŸ“„ Configuration:');
console.log('   Paystack Key:', env.VITE_PAYSTACK_PUBLIC_KEY?.substring(0, 15) + '...' || 'Not set');
console.log('   API URL:', env.VITE_API_URL || 'Not set');
console.log('   Notion URL:', env.VITE_NOTION_LIBRARY_URL || 'Not set');
console.log('');
console.log('ðŸ’¡ Remember to:');
console.log('   1. Add <script src="env-config.js"></script> to your HTML files');
console.log('   2. Add env-config.js to .gitignore (already done)');
console.log('   3. Run this script after updating .env file');
